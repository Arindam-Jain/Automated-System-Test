const { getDefaultPageSize } = require('../utils/page')

const _handler = function (req) {
  // only if http request
  if (!req._.req) return

  // target === null if view with parameters
  if (!req.target || !req.query.SELECT || req.query.SELECT.limit || req.query.SELECT.one) return

  // REVISIT: req.query.SELECT.one not yet set for reading single entity (cf. readToCQN) -> _one as quick fix
  if (req.query.SELECT._one) return

  req.query.limit(...[getDefaultPageSize(req.target), 0])
}

/*
 * handler registration
 */
module.exports = function () {
  _handler._initial = true
  this.before('READ', '*', _handler)
}
